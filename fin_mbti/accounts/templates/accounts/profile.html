{# templates/accounts/profile.html #}
{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  .profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    overflow: hidden;
    background-color: #f0f0f0;
    flex-shrink: 0;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .profile-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .section-card {
    background: #f0f8ff;
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 6px 14px rgba(0,0,0,0.08);
  }
</style>

<div class="container py-5">

  <!-- í—¤ë”: ì•„ë°”íƒ€ + ìœ ì €ëª… + íŒ”ë¡œìš° ì •ë³´ + ìˆ˜ì • ë²„íŠ¼ -->
  <div class="d-flex flex-wrap align-items-center justify-content-between mb-4">

    <div class="d-flex align-items-center">
      <!-- í´ë¦­ ê°€ëŠ¥í•œ ì›í˜• ì•„ë°”íƒ€ -->
      <div id="avatar-click" class="profile-avatar me-4">
        <img
          src="{% if person.profile_image %}{{ person.profile_image.url }}{% else %}{% static 'images/default_avatar.png' %}{% endif %}"
          alt="í”„ë¡œí•„ ì‚¬ì§„"
        >
      </div>
      <div>
        <h1 class="h3 mb-1">{{ person.username }}ë‹˜ì˜ í”„ë¡œí•„</h1>
        </h1>
        <small class="text-muted">
          íŒ”ë¡œì‰: <strong>{{ person.followings.count }}</strong> /
          íŒ”ë¡œì›Œ: <strong>{{ person.followers.count }}</strong>
        </small>
      </div>
    </div>

    {% if request.user == person %}
      <a href="{% url 'accounts:update' person.pk %}" class="btn btn-outline-secondary">
        í”„ë¡œí•„ ìˆ˜ì •
      </a>
    {% endif %}

  </div>

  <!-- ìˆ¨ê²¨ì§„ ì•„ë°”íƒ€ ì—…ë¡œë“œ í¼ -->
  <form
    id="avatar-form"
    action="{% url 'accounts:avatar_upload' person.pk %}"
    method="POST"
    enctype="multipart/form-data"
    style="display: none;"
  >
    {% csrf_token %}
    <input
      type="file"
      name="profile_image"
      id="avatar-input"
      accept="image/*"
    >
  </form>

  <!-- ê°€ì…í•œ ê¸ˆìœµ ìƒí’ˆ -->
  <div class="section-card">
    <h2 class="h5">ğŸ’¼ ê°€ì…í•œ ê¸ˆìœµ ìƒí’ˆ</h2>
    {% if person.joined_products %}
      <p>{{ person.joined_products }}</p>
    {% else %}
      <p class="text-secondary mb-0">ì•„ì§ ê°€ì…í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>

  <!-- ë‚´ ê²Œì‹œê¸€ -->
  <div class="section-card">
    <h2 class="h5">ğŸ“Œ {% if request.user != person %}{{ person.username }}ë‹˜ì˜ ê²Œì‹œê¸€{% else %}ë‚´ ê²Œì‹œê¸€{% endif %}</h2>
    {% if person.board_set.exists %}
      {% for board in person.board_set.all %}
        <div class="mb-3 p-3 bg-white rounded">
          <a href="{% url 'boards:detail' board.pk %}" class="h6 text-decoration-none text-dark">
            ğŸ“ {{ board.title }}
          </a>
          <div class="text-muted small">
            #{{ board.pk }} â€¢ {{ board.created_at|date:"Y.m.d H:i" }} â€¢ ëŒ“ê¸€ {{ board.comments.count }}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-secondary mb-0">ì‘ì„±í•œ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>

  <!-- ë‚´ ëŒ“ê¸€ -->
  <div class="section-card">
    <h2 class="h5">ğŸ’¬ {% if request.user != person %}{{ person.username }}ë‹˜ì˜ ëŒ“ê¸€{% else %}ë‚´ ëŒ“ê¸€{% endif %}</h2>
    {% if person.comment_set.exists %}
      {% for comment in person.comment_set.all %}
        <div class="mb-3 p-3 bg-white rounded">
          <p class="mb-1">ğŸ—¨ï¸ â€œ{{ comment.content }}â€</p>
          <small class="text-muted">
            in <a href="{% url 'boards:detail' comment.board.pk %}">{{ comment.board.title }}</a>,
            {{ comment.created_at|date:"Y.m.d H:i" }}
          </small>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-secondary mb-0">ì‘ì„±í•œ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>

  <!-- íŒ”ë¡œì›Œ ëª©ë¡ -->
  <div class="section-card">
    <h2 class="h5">ğŸ‘¥ Follower</h2>
    {% if person.followers.exists %}
      {% for follower in person.followers.all %}
        <div class="mb-3 p-3 bg-white rounded">
          <a href="{% url 'accounts:profile' follower.pk %}" class="h6 text-decoration-none text-dark">
            ğŸ‘¤ {{ follower.username }}
          </a>
          <div class="text-muted small">
            ê²Œì‹œê¸€ {{ follower.board_set.count }} â€¢ íŒ”ë¡œì‰ {{ follower.followings.count }} â€¢ íŒ”ë¡œì›Œ {{ follower.followers.count }}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-secondary mb-0">Followerê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
  // ì•„ë°”íƒ€ í´ë¦­ â†’ íŒŒì¼ ì„ íƒ
  document.getElementById('avatar-click')
    .addEventListener('click', function() {
      document.getElementById('avatar-input').click();
    });
  // íŒŒì¼ ì„ íƒ í›„ ìë™ í¼ ì œì¶œ
  document.getElementById('avatar-input')
    .addEventListener('change', function() {
      if (this.files.length) {
        document.getElementById('avatar-form').submit();
      }
    });
</script>
{% endblock %}
