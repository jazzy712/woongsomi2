{% extends "base.html" %}{% load static %}
{% block content %}
<a href="{% url 'boards:index' %}" class="btn btn-outline-secondary mb-3">&larr; ë’¤ë¡œ</a>
<div class="card mb-4">
  <div class="card-body">
    <h3>{{ board.title }}</h3>
    <div class="text-muted small mb-2">
      {{ board.author.username }} Â· {{ board.created_at|date:"Y-m-d H:i" }}
      <span class="ms-3">ğŸ‘ {{ board.view_count }}</span>
      <button id="btn-like" class="btn btn-sm btn-link">
        <span id="like-icon">{% if user in board.likes.all %}ğŸ’™{% else %}ğŸ¤{% endif %}</span>
        <span id="like-count">{{ board.likes.count }}</span>
      </button>
      {% if user == board.author %}
        <a href="{% url 'boards:update' board.pk %}" class="btn btn-sm btn-outline-primary ms-2">ìˆ˜ì •</a>
        <form method="post" class="d-inline">{% csrf_token %}
          <button class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
        </form>
      {% endif %}
    </div>
    <div>{{ board.content|linebreaksbr }}</div>
  </div>
</div>

<h5>ëŒ“ê¸€ {{ board.comment_count }}ê°œ</h5>
<ul class="list-group mb-3" id="comment-list">
  {% for c in comments %}
    {% include "boards/_comment.html" with comment=c %}
  {% empty %}
    <li class="list-group-item text-center text-muted">ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
  {% endfor %}
</ul>

{% if user.is_authenticated %}
<form id="comment-form" method="post">{% csrf_token %}
  {{ comment_form.as_p }}
  <button class="btn btn-primary">ëŒ“ê¸€ ë“±ë¡</button>
</form>
{% else %}
<p>ëŒ“ê¸€ì„ ë“±ë¡í•˜ë ¤ë©´ <a href="{% url 'accounts:login' %}">ë¡œê·¸ì¸</a>í•˜ì„¸ìš”.</p>
{% endif %}

{% if similar_boards %}
<hr>
<h6>ì´ ê¸€ì„ ë³¸ {{ board.related_mbti_type }} ë¶„ë“¤ì´ ë³¸ ë‹¤ë¥¸ ê¸€</h6>
<ul class="list-group">
  {% for s in similar_boards %}
  <li class="list-group-item">
    <a href="{% url 'boards:detail' s.pk %}">{{ s.title|truncatechars:30 }}</a>
  </li>
  {% endfor %}
</ul>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
// ì¢‹ì•„ìš”
document.getElementById('btn-like').onclick = e=>{
  e.preventDefault();
  fetch(`like/`,{
    method:'POST',
    headers:{'X-CSRFToken':'{{ csrf_token }}'}
  }).then(r=>r.json()).then(d=>{
    document.getElementById('like-icon').textContent = d.liked?'ğŸ’™':'ğŸ¤';
    document.getElementById('like-count').textContent = d.count;
  });
};
// ëŒ“ê¸€ ì œì¶œ
document.getElementById('comment-form')?.addEventListener('submit', e=>{
  // ë‹¨ìˆœ POST ìƒˆë¡œê³ ì¹¨ ì²˜ë¦¬ â†’ ë·°ì—ì„œ redirect ì²˜ë¦¬
});
</script>
{% endblock %}
